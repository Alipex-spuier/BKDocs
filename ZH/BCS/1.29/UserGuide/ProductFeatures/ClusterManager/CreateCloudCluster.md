# 新建公有云集群

本节介绍如何通过容器管理平台新建一个公有云Kubernetes集群，支持常见的公有云平台如腾讯云和谷歌云。

## 前提条件

- 已登录蓝鲸平台。
- 当前用户在权限中心已被授予容器管理平台（bk_bcs_app）的**项目查看**和**集群创建**权限。
- 用户在容器项目关联的CMDB业务中为**业务运维**角色。
- 如果创建的是公有云集群，需提前准备好相应的[云凭证](../ProjectManager/CloudToken.md)（如腾讯云SecretID和SecretKey或谷歌云服务账号的密钥文件）。

## 新建步骤

### 1. 进入添加集群界面

顶部导航栏中，选择**集群管理**进入集群管理页面。点击页面中的**添加集群**按钮。在新建集群的分类中，点击**公有云集群**。此时可以看到多个云厂商（如腾讯云、谷歌云等）的选择项。

### 2. 新建腾讯云TKE集群

点击**腾讯云**开始新建腾讯云TKE集群

#### ①填写集群基本信息

- 基本信息
    - **云凭证**：选择之前配置好的公有云云凭证。
    - **云项目**：选择要关联的云项目。
    - **集群名称**：填写集群名称，要求1~64个字符。
    - **集群版本**：选择当前腾讯云TKE支持的Kubernetes版本。
    - **标签** (可选)：为集群设置标签，便于管理和筛选。
    - **描述** (可选)：填写集群的相关描述信息，显示在集群基本信息页面。
- 集群环境
    - **所属区域**：选择腾讯云提供的地域。
    - **管控区域**：选择蓝鲸GSEAgent的管控区域。
    - **集群环境**：选择集群环境类型（测试或正式）。
- 集群配置
    - **操作系统**：选择腾讯TKE支持的操作系统镜像。
    - **运行时组件**：选择容器运行时（docker或containerd）。
    - **运行时版本**：选择对应的运行时版本。

#### ②填写网络配置

- 基本配置
    - **私有网络**：选择集群将使用的私有网络（VPC）。
    - **默认网络插件**：选择[TKE网络插件类型](https://cloud.tencent.com/document/product/457/50353)（[GlobalRouter](https://cloud.tencent.com/document/product/457/50354)或[VPC-CNI](https://cloud.tencent.com/document/product/457/50355)）。
    - **集群IP类型**：目前仅支持IPv4。
- 容器网络分配
    - **GlobalRouter**  
        - **容器网段CIDR**：指定容器网络的CIDR范围。
        - **Service IP数量**：选择可用的Service IP数量（128、256、512、1024、2048、4096）。
        - **单节点Pod数量上限**：选择每个节点的Pod数量上限（32、64、128）。
    - **VPC-CNI**  
        - **Service CIDR**：指定Service的CIDR范围。
        - **Pod IP**：分别为各可用区配置Pod IP数量。
        - **固定Pod IP**：选择是否开启对固定Pod IP的支持（默认不开启）。

#### ③填写控制面配置

- **集群模式**：托管集群或独立集群（更多详情请参考腾讯云官网文档，了解[集群的托管模式说明](https://cloud.tencent.com/document/product/457/31013)）。
- **托管集群**：TKE团队集中管理Kubernetes集群的控制面和Etcd，用户无需关心集群控制面的维护。
    - **集群规格**：支持自动升级配置。
    - **集群APIServer CLB**：支持通过CLB进行公网或内网访问（公网访问需配置安全组）。
- **独立集群**：使用用户已有或申请CVM资源作为控制面节点，仅支持3或5台主机。
    - **资源**：申请节点资源（计费模式、节点配置、安全组）或从CMDB业务主机拓扑中选择已有服务器。
    - **控制面节点转移模块**：将控制面节点从空闲机模块转移至指定业务模块。
    - **登录方式**：通过密码或SSH密钥登录（操作系统会被重装以保证环境一致性）。

#### ④填写节点配置

- **资源**：与控制面配置一致，确保节点的资源提供方式与控制面步骤一致。
- **节点转移模块**：将节点从空闲机模块转移至指定业务模块。
- **登录方式**：与控制面配置相同，支持密码或SSH密钥登录。

#### ⑤确认并创建

在填写完所有配置项后，仔细检查各项配置是否正确。确认无误后，点击确认按钮，系统将启动TKE集群创建流程。用户可随时通过集群列表中的**查看日志**，关注集群的创建进度和状态。

## 后续步骤

- **集群节点管理**：集群创建完成后，用户可以在集群详情中的**节点列表**标签页对集群中的节点进行操作，如停止调度、驱逐、设置标签、污点或删除等等。