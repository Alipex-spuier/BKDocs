# 产品简介

蓝鲸服务配置中心（Blueking Service Configuration Provider）是为业务提供服务配置管理功能，产品与蓝鲸其它产品打通，为业务提供一站式解决方案。

产品以业务作为顶层设计，隔离各个业务的服务配置，使用蓝鲸权限中心做服务级别的权限管控，支持业务传统与容器模式的业务配置托管，目前支持文件型配置与键值（KV）型配置。

## 产品使用流程

![product_usage_process](../Image/product_usage_process.png)

## 服务管理
* 蓝鲸服务配置平台是以“业务”作为顶层设计，不同的业务下有不同的服务，通过蓝鲸权限中心做权限控制

* 服务列表展示有两种视角，一种是查看业务下“业务下所有的服务”，另一种是“我创建的服务”

* 新建服务时需要指定配置的数据格式，目前只支持“文件型”、“键值型（KV）”配置，后续会支持“表格型（Table）”以及更多的数据格式

* 服务可以启停配置数据传输加密（数据存储默认会加密），使用RSA协议加密，允许用户指定加密密钥

## 配置管理
* 配置托管在服务下面

* 配置目前只支持“文件型”、“键值型（KV）”配置，后续版本会支持“表格型（Table）”以及更多的数据格式

* 文件型配置支持文本文件与二进制文件

* 文件型配置支持用户/用户组/文件权限配置

* 基于服务级别的配置文件版本控制

* 支持使用配置模板

* 支持使用变量

* 支持前 / 后置脚本

* 支持灰度发布与全量发布

## 前 / 后置脚本
* 服务配置上线过程中支持前置脚本，前置脚本就在拉取配置文件前执行的脚本，目前支持bash、python脚本，使用在旧版本配置本地备份等场景

* 服务配置上线过程中支持后置脚本，前置脚本就在拉取配置文件后执行的脚本，目前支持bash、python脚本，使用在判断配置文件是否有拉群完成，把配置文件从临时目录放置在正式目录，重载/重启进程让配置文件生效等场景

* 前 / 后置脚所使用的脚本在“脚本管理”功能项里管理，支持脚本版本管理与脚本版本上下线操作


## 分组管理
* 分组主要用于配置文件灰度发布场景，如果业务配置不需要灰度发布则无需使用分组

* 分组是基于标签组合的分组策略，服务配置发布版本时指定特定分组，同时给业务客户端（sidecar / agent / sdk）配置相应的标签，客户端在拉取配置文件时会根据客户端配置的标签去拉取对应版本的配置文件

* 支持服务可见范围配置，默认是业务下所有服务都可见，配置可见范围后只有部分服务可使用该分组


## 配置模版
* 配置模板用于业务下多个服务共用配置文件的场景，一般结合变量来使用

* 要使用配置模板，必须先有模板空间，模板空间用于隔离业务不同的功能模块

* 配置模板在模板空间下新增，与服务配置项没有太大的差别，差别在于单个配置模板文件具备版本控制能力，而服务配置项是基于整体服务做版本控制

* 根据不同的场景，在同一模板空间下可以指定一个或多个配置模板创建模板套餐，不同模板套餐用于不同场景

* 服务配置项中可以引用一个或多个模板套餐，注意：服务配置项只能引用模板套餐，而不能直接引用配置模板

* 支持服务可见范围配置，默认是业务下所有服务都可以使用，配置可见范围后只有部分服务可使用该模板套餐


## 变量
* 变量用于业务下多个服务共用配置文件的场景，一般结合配置模板来使用

* 后台会在生成版本前，匹配“bk_bscp_”或“BK_BSCP_”前缀字符串，自动渲染变量名称为变量值，具体格式：{{ .bk_bscp_$变量名称 }} 或 {{ .BK_BSCP_$变量名称 }} 

* 变量管理中可以预先配置变量默认值，在生成服务配置版本时如果发现变量值为空，会给变量自动填充预先配置好的默认值，如果服务配置的上个版本中已经使用了该变量，会优先使用上个版本填充的变量值

* 可以在服务配置“未命名版本”中预先设置变量值，也可以在生成版本时再填写变量值

 

## 客户端密钥
* 服务密钥在业务的BSCP客户端中配置，为业务通过BSCP客户端拉取配置提供身份验证

* 服务密钥在文件型配置中控制粒度可以精确到单个文件，键值（KV）型配置中可以精确到单个配置项（键）


## 配置存储
* 蓝鲸服务配置使用蓝鲸制品库（bkrepo）做文件型配置存储

* 蓝鲸制品库（bkrepo）是devops中打通开发、构建、部署的重要组件，制品库提供从依赖管理、构建产出物管理（二进制包、报告、容器镜像）、部署构件（helm chart，oci chart、rpm程序包），为这些文件包提供数据存储


## 客户端配置
* 容器客户端，以容器sidecar方式部署，与业务容器部署在同一Pod

* 传统主机客户端，使用蓝鲸节点管理插件方式部署