# 进程服务说明

## 简介

在 [应用进程](./process_procfile.md) 中，我们介绍了如何为应用定义进程以及如何管理进程。

但进程是无法单独为他人提供服务的，我们需要配置“访问主入口”与“进程服务”来将应用进程暴露给应用内部与外部用户。

本文是“访问主入口”与“进程服务”的相关介绍。

## 访问主入口

每个蓝鲸应用默认拥有“预发布”与“正式”两个不同的部署环境，而每个环境都拥有一个“访问主入口”。当用户通过浏览器请求各环境外部地址时，请求将会被转发到该环境“访问主入口”所指向的目标服务。

默认情况下，各环境“访问主入口”被设置为 **web** 进程的 **5000** 端口。同时，为了方便进程监听该默认端口，平台也会在应用运行环境中注入一个名为 `PORT` 的环境变量，其值为 5000。详见 [内置环境变量说明](./builtin_configvars.md)。

## 进程服务

进程服务是应用进程完成内部通信和外部暴露的核心概念，它的主要作用如下：

- 在应用内部，通过 “进程服务名称 + 端口号” _（如 http://default-bkapp-amazingblues-stag-web:8080）_ 来进行内部通信
- 设置某进程服务端口为“访问主入口”，可以将服务对外暴露

### 如何查看

在『访问管理』-『进程服务管理』页面，可以查看当前应用的进程服务情况。
每个进程服务下可以设置一个或多个端口规则，规则里各字段含义如下：

- **名称**：用于区分端口规则的名字，同一进程下不能重复
- **协议**：TCP / UDP
- **服务端口**：在应用内通过“服务名称”访问的端口号，同一进程下不能重复
- **进程内端口**：进程真正监听的端口号，比如 web 进程通过 "gunicorn -b :8080" 启动，那么它所监听的进程内端口就是 8080

默认情况下，平台会为每一个进程创建一条默认规则：

- 名称：http
- 协议：TCP
- 服务端口：80
- 进程内端口：5000

这条默认规则可以保障新应用在第一次部署后，不用配置任何规则也直接被浏览器访问。
